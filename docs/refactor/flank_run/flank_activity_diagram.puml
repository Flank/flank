@startuml
'https://plantuml.com/activity-diagram-beta

start
:main;
partition "cli command" #LightGreen {
split

:login;

split again
partition "new test run" #LightBlue  {
partition "run tests" #LightBlue {

split
partition "run android" #LightBlue {
partition "before run tests" #LightBlue {
#snow:start stop watch;
#snow:prepare result directory;
#MediumSeaGreen:ensure not running on mock;
}
'na pewno atomowe, sklada sie z kilku krokow w sumie ale to raczej nie problem
'jesli przyjmujemy tez pokazywanie google api to w taki razie czy nie powinno byc na jakiÅ› kolor?
'mamy tak naprawde 3 obiekty stricte zwiazane z api ftl GcTesting, GcStorage, GcTOolResults
'oznaczac je na jakis inny kolor?
#snow:prepare data;
#snow:upload files;
:create test contexts;
note right: In progress
partition "dump shards" #LightBlue {
#snow:as matrix test shards;
'rozbic na ify? (brzydki json)
#snow:prepare dump file;
#snow:upload dump file;
}
#snow:upload test files;
repeat
#snow:create test config;
#snow:build test matrix;
#snow:execute with retry;
repeat while (for each context)
#snow:before run message;
partition "after test run" #LightBlue {
#snow:update matrix file;
#snow:save config file;
#snow:save session id;
#snow:upload session id;
}
#snow:test results>
}

split again
partition "run ios" #LightBlue {
:before run tests;
:prepare data;
:upload files;
:dump shards;
:before run message;
:create test contexts;
repeat
:upload;
:create test config;
:build test matrix;
:execute with retry;
repeat while (for each context)
:after test run;
:test results>
}

end split
}

partition "poll matrices" #LightBlue {
repeat
:print next not complete matrix status;
repeat while (any matrix is not complete)
:test matrices>
}
partition "generate report" #LightBlue {
:parse test suite;
:generate cost report;
:generate matrix results report;
:generate optional htmlErrorReport;
:generate junit report;
:refresh matrices and get executions;
:process junit results;
:createAndUploadPerformanceMetricsForAndroid;

}
:fetch artifacts;
:print matrices web links;
:validate matrices;
}



split again
partition "refresh last run" #LightBlue {
:get last matrices;
:get last args;
:refresh matrices;
:poll matrices;
:fetch artifacts;
:generate report;
:validate matrices;
}



split again
partition "cancel last run" #LightBlue {
:get last matrices;
:get last args;
:cancel matrices;
}



split again
partition "android / ios" #LightBlue {
split


partition "configuration" #LightBlue {
split
:print locales description;
split again
:print locales table;
split end
}

split again
partition "models" #LightBlue {
split
:print description;
split again
:print table;
split end
}

split again
partition "supported orientations" #LightBlue {
split
:print table;
split end
}

split again
partition "versions" #LightBlue {
split
:print description;
split again
:print table;
split end
}


split again
:print ip blocks list;

split again
:print network configurations;

split again
:print network profile description;

split again
:print provided software;

end split
}
end split
stop

@enduml
