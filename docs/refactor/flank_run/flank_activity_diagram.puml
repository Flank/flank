@startuml
'https://plantuml.com/activity-diagram-beta

start
:main;
partition "cli command" #LightGreen {
split


:login;


split again
partition "new test run" #LightBlue  {
partition "run tests" #LightBlue {

split
partition "run android" #LightBlue {
:before run tests;
:prepare data;
:upload files;
:create test contexts;
repeat
:dump shards;
:upload;
:create test config;
:build test matrix;
:execute with retry;
repeat while (for each context)
:before run message;
:after test run;
:test results>
}

split again
partition "run ios" #LightBlue {
:before run tests;
:prepare data;
:upload files;
:dump shards;
:before run message;
:create test contexts;
repeat
:upload;
:create test config;
:build test matrix;
:execute with retry;
repeat while (for each context)
:after test run;
:test results>
}

end split
}

partition "poll matrices" #LightBlue {
repeat
:print next not complete matrix status;
repeat while (any matrix is not complete)
:test matrices>
}
partition "generate report" #LightBlue {
:parse test suite;
:generate cost report;
:generate matrix results report;
:generate optional htmlErrorReport;
:generate junit report;
:refresh matrices and get executions;
:process junit results;
:createAndUploadPerformanceMetricsForAndroid;

}
:fetch artifacts;
:print matrices web links;
:validate matrices;
}



split again
partition "refresh last run" #LightBlue {
:get last matrices;
:get last args;
:refresh matrices;
:poll matrices;
:fetch artifacts;
:generate report;
:validate matrices;
}



split again
partition "cancel last run" #LightBlue {
:get last matrices;
:get last args;
:cancel matrices;
}



split again
partition "android / ios" #LightBlue {
split


partition "configuration" #LightBlue {
split
:print locales description;
split again
:print locales table;
split end
}

split again
partition "models" #LightBlue {
split
:print description;
split again
:print table;
split end
}

split again
partition "supported orientations" #LightBlue {
split
:print table;
split end
}

split again
partition "versions" #LightBlue {
split
:print description;
split again
:print table;
split end
}


split again
:print ip blocks list;

split again
:print network configurations;

split again
:print network profile description;

split again
:print provided software;

end split
}
end split
stop

@enduml
